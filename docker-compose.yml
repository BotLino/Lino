version: '3'

services:
    lino:
        # If you want to development and use another image,
        # change the image to the Dockerfile that corresponds to the one you want to use.
        build:
            context: .
            dockerfile: docker/Telegram.Dockerfile
        ports:
            - 5002:5002
        volumes:
            - .:/2018.2-Lino
        stdin_open: true
        tty: true
        environment:
           - TRAINING_EPOCHS=300
           - TELEGRAM_ACCESS_TOKEN=677504218:AAHaga656yF0tqY0vfH5NgALds6UFn0VEek
           - VERIFY=ulib_fga_bot
           - PSID=303317230254781
           - FACEBOOK_ACCESS_TOKEN=EAANoEk6bk1MBACfBTZACN42HlDbVZCg5cRqoyZBwfZALh0mZCvd3hXDPuJl1bPijVQPXZBqfUvduVTKh96PFSKpGC2lrHhgb5kZCRMkkZByHtu0RQKUTM6P8OTnZCvGyfzinCsg64rbUoVN4MjaOBEblDzZBuSDyooMj98ZB5tJ3q8EXwZDZD
           - SECRET=9faf1e57e1d429ac42473796a8eb0849
           - WEBHOOK_URL=https://96fffef2.ngrok.io/webhook
           - TELEGRAM_DB_URI=mongodb://mongo_telegram:27010/lino_telegram
           - FACEBOOK_DB_URI=mongodb://mongo_facebook:27011/lino_facebook
        # bot credentials in train.py or another train file.
        depends_on:
            - cronjob
            - mongo_telegram
            - mongo_facebook

    mongo_telegram:
        image: mongo:latest
        command: mongod --port 27010
        volumes:
            - /tmp:/data/db
        ports:
            - 27010:27010

    mongo_facebook:
        image: mongo:latest
        command: mongod --port 27011
        volumes:
            - /tmp:/data/db
        ports:
            - 27011:27011

    cronjob:
        image: guila/cronjob:latest
        volumes:
            - ./outputs:/home
        stdin_open: true
        tty: true
        environment:
            - URI_TELEGRAM=mongodb://mongo_telegram:27010/lino_telegram
            - URI_FACEBOOK=AAA
            - TELEGRAM_ACCESS_TOKEN=677504218:AAHaga656yF0tqY0vfH5NgALds6UFn0VEek
            - FACEBOOK_ACCESS_TOKEN=AAA
            - PSID=AAA
        depends_on:
            - webcrawler
            - mongo_telegram
            - mongo_facebook

    webcrawler:
        image: guila/webcrawler:latest
        ports:
            - 5000:5000
        depends_on:
            - mongo_ru

    mongo_ru:
        image: mongo:latest
        volumes:
            - /tmp:/data/db
        ports:
            - 27017:27017
